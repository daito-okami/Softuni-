{% extends 'main/base.html' %}
{% load static %}


{% block content %}
 <div class="container">
        <h1>Mood Tracker Dashboard</h1>

<div class="container">
    <h1>Mood Tracker Dashboard</h1>

    <form method="POST" action="">
        {% csrf_token %}
        <div class="form-group">
            <label for="mood">Mood:</label>
            <select id="mood" name="mood">
                <option value="">-- Select Mood --</option>
                {% for mood_choice in MOOD_CHOICES %}
                    <option value="{{ mood_choice.0 }}">{{ mood_choice.1 }}</option>
                {% endfor %}
            </select>
            <button id="start-mood">Start Mood</button>
            <button id="change-mood" style="display: none;">Change Mood</button>

            <div id="mood-tracking-status"></div>
        </div>

        <h2>Currently Tracked Mood</h2>
        <div id="current-mood">
            <p id="current-mood-mood"></p>
            <p id="current-mood-start-time"></p>
        </div>

        <div class="previous-activities">
            <h2>Previous Activities</h2>
            </div>
    </form>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>


<script>

$(document).ready(function() {
    // Event Listener for "Start Mood" Button
    $('#start-mood').on('click', function() {

        var selectedMood = $('#mood').val();

        $.ajax({
        headers: { 'X-Requested-With': 'XMLHttpRequest' },
        url: '/dashboard',  // Replace with your Django URL for starting moods
        type: 'POST',
        data: { 'mood': selectedMood },
        beforeSend: function() {  // Add 'beforeSend' here
            console.log("AJAX request about to be sent.");
        },
        success: function(response) {
                if (response.success) {
                    $('#start-mood').hide();
                    $('#change-mood').show();
                    updateTrackingStatus('Mood Started: ' + selectedMood);

                    // Update current mood display
                    $('#current-mood-mood').text('Mood: ' + selectedMood);
                    $('#current-mood-start-time').text('Start Time: ' +  new Date().toLocaleString());
                } else {
                    // Handle errors (e.g., display an error message)
                }
            }
        });
    });

    // Event Listener for "Change Mood" Button
    $('#change-mood').on('click', function() {
        var newMood = $('#mood').val();

        $.ajax({
            url: '/dashboard', // URL for ending current mood and starting new
            type: 'POST',
            data: { 'mood': newMood },
            success: function(response) {
               if (response.success) {
                    // Update current mood display
                    $('#current-mood-mood').text('Mood: ' + newMood);
                    $('#current-mood-start-time').text('Start Time: ' +  new Date().toLocaleString());
                } else {
                    // Handle errors
                }
            }
        });
    });

    // Helper function to update the status area
    function updateTrackingStatus(message) {
        $('#mood-tracking-status').text(message);
    }
});
</script>
        </div>
</div>
{% endblock %}